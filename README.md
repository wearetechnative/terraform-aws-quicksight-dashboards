# Deploying AWS QuickSight Dashboards with Terraform

This Terraform configuration is designed to deploy AWS QuickSight dashboards by setting up necessary resources and configurations in AWS. The setup ensures that your QuickSight environment is configured correctly for data visualization and reporting.

## Prerequisites

Before you begin, ensure you have the following:

- **Terraform** installed on your local machine or server.
- **AWS CLI** configured with credentials that have sufficient permissions to manage QuickSight resources.
- **AWS Account** with permissions to create and manage resources such as IAM roles, QuickSight dashboards, datasets, and data sources.

## Files Included

This configuration includes the following Terraform files:

- **`main.tf`**: Contains the primary resources for setting up QuickSight dashboards and associated resources.
- **`dashboards.tf`**: Defines specific configurations for QuickSight dashboards.
- **`variables.tf`**: Defines the input variables required for the Terraform configuration.
- **`outputs.tf`**: Specifies the outputs generated by the Terraform configuration.
- **`versions.tf`**: Specifies the required Terraform and provider versions.
- **`README.md`**: Documentation for the Terraform configuration.

## Terraform Module Example

This configuration can be utilized by defining a module in your Terraform setup. Below is an example of how you might configure this module, including the necessary providers:

```hcl
provider "aws" {
  profile = "data_collection"
  region  = "eu-central-1"
  alias   = "data_collection"
}

provider "aws" {
  region = "us-east-1"
  alias  = "useast1"
}

module "cid_dashboards" {
  source = "./terraform-aws-quicksight-dashboards/"

  stack_name      = "Cloud-Intelligence-Dashboards"
  stack_parameters = {
    "PrerequisitesQuickSight"            = "yes"
    "PrerequisitesQuickSightPermissions" = "yes"
    "QuickSightUser"                     = "landing_zone_playground/nick@technative.nl" # Change this to your QuickSight user
    "DeployCUDOSDashboard"               = "yes"
    "DeployCostIntelligenceDashboard"    = "yes"
    "DeployKPIDashboard"                 = "yes"
  }

  providers = {
    aws = aws.data_collection
  }
}
```

### Explanation of Providers:

- **`aws.data_collection`**: This provider configuration uses the `data_collection` profile and is set to the `eu-central-1` region. It is used for specific operations that need to be performed in this region.
- **`aws.useast1`**: This provider configuration is set to the `us-east-1` region and can be used for operations that need to be performed in this region.

### Explanation of Parameters:

- **`stack_name`**: The name assigned to the stack being deployed.
- **`stack_parameters`**: A map of parameters required for the QuickSight dashboards. These include:
  - `PrerequisitesQuickSight`: Set to `"yes"` to deploy QuickSight prerequisites.
  - `PrerequisitesQuickSightPermissions`: Set to `"yes"` to configure the necessary QuickSight permissions.
  - `QuickSightUser`: The QuickSight user ARN that will own and manage the resources.
  - `DeployCUDOSDashboard`: Set to `"yes"` to deploy the CUDOS dashboard.
  - `DeployCostIntelligenceDashboard`: Set to `"yes"` to deploy the Cost Intelligence dashboard.
  - `DeployKPIDashboard`: Set to `"yes"` to deploy the KPI dashboard.

## Usage

1. **Clone the Repository**

   Clone this repository to your local machine using SSH:

   ```bash
   git clone git@github.com:wearetechnative/terraform-aws-quicksight-dashboards.git
   ```

2. **Initialize Terraform**

   Initialize the Terraform configuration by running:

   ```bash
   terraform init
   ```

3. **Plan the Terraform Deployment**

   Generate an execution plan with the following command:

   ```bash
   terraform plan
   ```

   Review the plan to ensure that it matches your expectations.

4. **Apply the Terraform Deployment**

   Apply the Terraform configuration to create the resources:

   ```bash
   terraform apply
   ```

   Confirm the prompt with `yes` to proceed with resource creation.

5. **Verify the Resources**

   After Terraform completes, you can verify the creation of the QuickSight dashboards and other resources through the AWS Management Console or by using the AWS CLI.

   ```bash
   aws quicksight list-dashboards --aws-account-id 123456789012
   ```

6. **Check QuickSight Dashboards**

   Once the resources are in place, navigate to the AWS QuickSight Console to ensure that the dashboards are created and functioning as expected.

7. **Cleanup (Optional)**

   If you ever need to remove the resources created by this Terraform configuration, you can run:

   ```bash
   terraform destroy
   ```

   Confirm the prompt with `yes` to remove the resources.

## Security Considerations

- **IAM Permissions**: Ensure that the IAM roles created or used have the least privilege necessary to interact with QuickSight and other AWS services.
- **Resource Ownership**: Verify that the QuickSight user specified has appropriate permissions to manage the resources created by this configuration.

## Outputs

After applying this Terraform configuration, the following outputs will be available:

- **`dashboard_id`**: The ID of the QuickSight dashboard created.
- **`dashboard_arn`**: The ARN of the QuickSight dashboard created.

## Troubleshooting

- **Access Denied Errors**: Ensure that your AWS credentials have sufficient permissions to create and manage QuickSight resources.
- **Resource Conflicts**: Ensure that the names and ARNs provided in the variables do not conflict with existing QuickSight resources.